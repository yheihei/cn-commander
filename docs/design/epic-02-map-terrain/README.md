# エピック2: マップ・地形システム 設計書

## 概要
本エピックでは、512×512グリッドのタイルマップシステムと、地形効果、カメラシステムを実装しました。これらのコンポーネントが連携して、戦術的な深みのあるマップシステムを構築しています。

## タスク一覧

### [task-2-1: タイルマップシステム実装](./task-2-1-tilemap.md) ✅
- 512×512グリッドのタイルマップ基盤
- MapManager、MapLayer、MapTileの3層構造
- 座標変換システム（グリッド⇔ピクセル）

### [task-2-2: 地形タイプ定義と描画](./task-2-2-terrain-types.md) ✅
- 3種類の地形タイプ（平地、森林、山地）
- タイルセットによる地形描画
- 地形タイプごとの視覚的差別化

### [task-2-3: 地形効果システム](./task-2-3-terrain-effects.md) ✅
- 移動コスト（1.0〜2.0）
- 防御補正（0〜30%）
- 攻撃補正（-10〜15%）
- 視界補正（-2〜+3マス）

### [task-2-4: カメラシステム](./task-2-4-camera-system.md) ✅
- 20×20マス固定表示（ズーム値2.25固定）
- キーボード/マウスによるスクロール
- マップ境界制限

## システム構成

```
MapManager（統括管理）
├── MapLayer（レイヤー管理）×複数
│   └── MapTile（個別タイル）×多数
└── BaseData（拠点情報）×複数

GameScene（シーン管理）
└── Camera（表示制御）
    └── 固定ズーム（2.25）
    └── スクロール機能
```

## 主要インターフェース

### マップ操作
- `mapManager.loadMap(mapData)`: マップ読み込み
- `mapManager.getTileAt(x, y)`: タイル取得
- `mapManager.getBaseAt(x, y)`: 拠点取得

### 地形情報
- `tile.getTileType()`: 地形タイプ取得
- `tile.getTerrainEffect()`: 地形効果取得

### カメラ操作
- 矢印キー: スクロール
- 右クリックドラッグ: ドラッグスクロール

## 技術仕様

### マップサイズ
- グリッド: 512×512タイル
- ピクセル: 8,192×8,192px
- タイルサイズ: 16×16px

### メモリ使用量（概算）
- 1タイル: 約200バイト
- フルマップ: 約52MB（262,144タイル）

### パフォーマンス目標
- マップ生成: 3秒以内
- タイルアクセス: 1ms以下
- スクロール: 30FPS維持

## 今後の拡張予定
1. カリング処理による描画最適化
2. Phaser.Tilemapへの移行検討
3. 地形タイプの追加（河川、道路など）
4. ミニマップの実装
5. フォグオブウォーの実装