# [task-2-3] 地形効果システム

## 概要
- エピック: #2
- タスク: #2-3
- 関連PR/要件: 移動コスト、防御補正、攻撃補正、視界補正の実装

## 設計方針

### 地形効果の設計思想
- **戦術的深度**: 地形を活用した戦術が可能になるバランス
- **直感的理解**: プレイヤーが効果を直感的に理解できる数値設定
- **拡張性**: 新しい効果タイプを追加しやすい構造

### 効果値の決定根拠
- **移動コスト**: 平地を基準（1.0）として、地形の通りにくさを表現
- **防御補正**: 遮蔽物や高所の優位性を％で表現
- **攻撃補正**: 高所からの攻撃優位性、森林での射線制限を表現
- **視界補正**: 高所からの見通しの良さ、森林での視界制限を表現

## 地形効果の詳細

### データ構造

#### TerrainEffect（地形効果定義）
- **movementCost**: 移動コスト（1.0が基準値）
- **defenseBonus**: 防御補正（パーセンテージ）
- **attackBonus**: 攻撃補正（パーセンテージ）
- **visionModifier**: 視界補正（マス数）

#### 地形別効果値

| 地形タイプ | 移動コスト | 防御補正 | 攻撃補正 | 視界補正 |
|------------|-------------|----------|----------|----------|
| 平地       | 1.0         | 0%       | 0%       | 0マス    |
| 森林       | 1.5         | +20%     | -10%     | -2マス   |
| 山地       | 2.0         | +30%     | +15%     | +3マス   |

### 効果値の設計根拠
- **森林**: 遮蔽物による防御優位、但し射線制限と視界不良
- **山地**: 高所の優位性を全面的に表現、但し移動は困難

### 効果の適用方法

#### 移動速度への適用
- 実際の移動時間は、軍団移動速度、モード補正、地形コストの組み合わせで決定
- 例：速度12の軍団が森林（コスト1.5）を通過する場合、5.0秒/マス

#### 戦闘計算への適用
- 攻撃力・防御力に地形補正を乗算して実効値を計算
- 森林では防御+20%、攻撃-10%の補正が適用される
- 山地では防御+30%、攻撃+15%の補正が適用される

#### 視界計算への適用
- 基本視界に地形補正を加算して実効視界を計算
- 森林では-2マス、山地では+3マスの補正
- 職業やモードによる補正と組み合わせて適用

## インターフェース定義

### 公開API
- `MapTile.getTerrainEffect()`: タイルの地形効果を取得
- `MapTile.getTileType()`: タイルの地形タイプを取得

### 他システムとの連携方法
1. **移動システム**
   - `movementCost`を取得して移動時間を計算
   - 経路探索時のコスト計算に使用

2. **戦闘システム**
   - `defenseBonus`を防御側の計算に適用
   - `attackBonus`を攻撃側の計算に適用

3. **視界システム**
   - `visionModifier`を視界範囲計算に加算
   - フォグオブウォーの更新に使用

## テスト方針

### 統合テストの観点
1. **効果値の正確性**
   - 各地形タイプから正しい効果値を取得
   - 定数定義と一致することを確認

2. **複数タイルでの一貫性**
   - 同じ地形タイプで同じ効果値
   - マップ全体での効果値の分布確認

3. **境界値テスト**
   - 効果値0の処理（平地）
   - 負の効果値の処理（森林の攻撃補正）
   - 最大効果値の処理

4. **実使用シナリオ**
   - 移動経路上の地形効果累積
   - 戦闘位置の地形効果確認
   - 視界計算での地形効果適用

## 未解決事項
- [ ] 複合地形の効果（森林＋丘陵など）
- [ ] 天候による地形効果の変化
- [ ] ユニットタイプ別の地形相性（飛行ユニットは地形無視など）
- [ ] 地形効果のビジュアルフィードバック（UIでの表示）
- [ ] 地形効果の動的変更（爆撃で地形が変わるなど）
