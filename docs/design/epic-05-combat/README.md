# エピック5: 戦闘システム設計概要

## 概要
エピック5では、クリプト忍者咲耶コマンダーの戦闘システムを実装します。これには戦闘計算、攻撃間隔、射程判定、戦闘エフェクトが含まれます。

## システム構成

### 主要コンポーネント
1. **CombatSystem** - 戦闘全体の管理
2. **CombatCalculator** - 戦闘計算（命中率、ダメージ）
3. **AttackTimer** - 攻撃間隔の管理
4. **RangeCalculator** - 射程判定
5. **CombatEffectManager** - 戦闘エフェクトの表示

### データフロー
```
1. 軍団が戦闘移動/待機モードで敵を発見
2. RangeCalculatorで射程内の敵をチェック
3. AttackTimerで攻撃タイミングを管理
4. CombatCalculatorで命中判定
5. CombatEffectManagerでエフェクト表示
6. ダメージ適用（固定値1）
```

## タスク構成

### task-5-1: 戦闘計算システム
- 攻撃成功率の計算
- ダメージ処理（固定値1）
- 武器耐久度の消費

### task-5-2: 攻撃間隔システム
- 各メンバーの個別タイマー管理
- 速さに基づく攻撃間隔計算（90/速さ秒）

### task-5-3: 射程システム  
- 武器タイプ別の射程判定
- 刀剣：1-3マス
- 手裏剣：2-6マス

### task-5-4: 戦闘エフェクト
- 斬撃エフェクト（刀剣）
- 手裏剣飛翔エフェクト
- ヒットエフェクト（爆発）

## 技術選定

### アーキテクチャ
- **Manager-Component パターン**: CombatSystemが各コンポーネントを統括
- **イベント駆動**: 攻撃タイミングはタイマーイベントで管理
- **状態管理**: 各メンバーの戦闘状態を個別に管理

### 既存システムとの連携
- ArmyManager: 軍団情報の取得
- MovementManager: 移動モードの確認
- VisionSystem/DiscoverySystem: 敵発見状態の確認
- ItemSystem: 武器情報の取得

## 実装優先順位
1. 射程システム（task-5-3） - 攻撃可能判定の基盤
2. 戦闘計算システム（task-5-1） - コア戦闘ロジック
3. 攻撃間隔システム（task-5-2） - タイミング制御
4. 戦闘エフェクト（task-5-4） - 視覚的フィードバック

## 未解決事項
- [ ] 地形効果の攻撃/防御補正の適用タイミング
- [ ] 複数の敵軍団が射程内にいる場合の優先順位
- [ ] 武器切り替え時の攻撃タイマーリセット処理