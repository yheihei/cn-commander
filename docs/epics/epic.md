# クリプト忍者咲耶コマンダー エピックと詳細タスク一覧

## エピック一覧

### 【エピック1】基盤システム - Phaser3セットアップ、ゲームループ、基本描画システム
**優先度**: 高

- [x] **task-1-1**: Phaser3プロジェクト初期セットアップ（1280x720解像度、30FPS設定）
- [ ] **task-1-2**: ゲーム時間管理とポーズシステム
  - [ ] **task-1-2-1**: GameTimeManager実装
    - [ ] **task-1-2-1-1**: ディレクトリ・ファイル作成とクラス骨格定義
    - [ ] **task-1-2-1-2**: pause/resume/getIsPaused実装
    - [ ] **task-1-2-1-3**: update()メソッド実装
    - [ ] **task-1-2-1-4**: 単体テスト作成
    - [ ] **task-1-2-1-5**: 動作確認とドキュメント
  - [ ] **task-1-2-2**: 既存システムへのGameTimeManager統合（MovementProcessor、CombatTimerManager、ProductionManager等）
  - [ ] **task-1-2-3**: UIManagerポーズ制御実装（モーダルUI追跡、自動ポーズ/再開）
  - [ ] **task-1-2-4**: テスト更新（既存テスト修正、統合テスト追加）
  - [ ] **task-1-2-5**: PRD更新（ポーズシステムドキュメント化）
- [ ] **task-1-3**: シーン管理システム（タイトル、ステージ選択、バトル、結果画面）
- [ ] **task-1-4**: 16x16ドット絵アセット読み込みシステム
- [x] **task-1-5**: キャラクター顔画像アセット読み込みシステム（正方形、キャラクター個別対応）

### 【エピック2】マップ・地形システム - 512x512マップ、地形効果、移動コスト
**優先度**: 高

- [x] **task-2-1**: タイルマップシステム実装（512x512グリッド）
- [x] **task-2-2**: 地形タイプ定義（平地、森林、山地）と描画
- [x] **task-2-3**: 地形効果システム（移動コスト、防御補正、攻撃補正、視界補正）
- [x] **task-2-4**: カメラシステム（スクロール、固定表示）

### 【エピック3】キャラクター・軍団システム - 職業、能力値、軍団編成
**優先度**: 高

- [x] **task-3-1**: キャラクター基本システム（HP、攻撃力、防御力、速さ、移動速度、視界）
- [x] **task-3-2**: 職業システム（風忍、鉄忍、影忍、薬忍）とクラススキル
- [x] **task-3-3**: 軍団システム（指揮官1名＋一般兵3名）
- **task-3-4**: 軍団編成UI（3段階フロー）
  - [x] **task-3-4-1**: 兵士選択UI（待機兵士リスト、テーブル表示、左右クリック操作）
  - [x] **task-3-4-2**: アイテム選択UI（倉庫アイテム表示、兵士への割り当て）
  - [x] **task-3-4-3**: 出撃位置選択UI（4方向選択、2マス先配置）
- [x] **task-3-5**: 軍団所属識別システム（owner/faction属性の追加）

### 【エピック4】移動システム - 経路指定、移動モード、移動速度計算
**優先度**: 高

- [x] **task-4-1**: 移動指示システム（最大4地点の経路指定）
- [x] **task-4-2**: 移動モード（通常移動、戦闘移動、待機）
- [x] **task-4-3**: 移動速度計算（軍団平均速度、地形コスト）
- [x] **task-4-4**: 移動処理
- [x] **task-4-5**: 移動指示UI（行動選択メニュー、モード選択UI、✕マーク表示）

### 【エピック5】戦闘システム - 攻撃計算、射程、エフェクト
**優先度**: 高

- [x] **task-5-1**: 戦闘計算システム（攻撃成功率、ダメージ固定値1）
- [x] **task-5-2**: 攻撃間隔システム（90/速さ秒）
- [x] **task-5-3**: 射程システム（刀剣1-3マス、手裏剣2-6マス）
- [x] **task-5-4**: 戦闘エフェクト（斬撃、手裏剣、ヒット）
- [x] **task-5-5**: 攻撃目標指定システム（軍団単位での目標選択、優先攻撃）
- [x] **task-5-6**: 拠点攻撃指定システム（拠点を攻撃目標に指定）

### 【エピック6】視界・発見システム - 視界範囲、敵発見、視界共有
**優先度**: 高

- [x] **task-6-1**: 視界計算システム（基本視界＋クラス＋モード＋地形）
- [x] **task-6-2**: 発見メカニクス（未発見/発見済み状態管理）
- [x] **task-6-3**: 視界共有システム（全軍団間での視界共有）
- [ ] **task-6-4**: フォグオブウォー表示

### 【エピック7】拠点管理システム - 拠点種類、占領、機能
**優先度**: 高

- [x] **task-7-1**: 拠点基本システム（本拠地、中立拠点、占領拠点）
- [x] **task-7-2**: 拠点戦闘システム（HP管理）
- [x] **task-7-3**: 拠点占領システム（占領コマンド）
- [x] **task-7-4**: 駐留システム（アイテム補給、入院）
  - [x] **task-7-4-1**: 駐留コマンドUI実装（ActionMenuに駐留オプション追加、3マス判定）
  - [x] **task-7-4-2**: 拠点選択モード実装（拠点選択モード遷移、ハイライト表示）  
  - [x] **task-7-4-3**: 駐留実行処理（軍団の駐留状態管理、マップから非表示化、BaseManager/ArmyManagerへの登録）
  - [x] **task-7-4-4**: 駐留軍団の再出撃機能
    - [x] **task-7-4-4-1** 駐留軍団管理UI作成（アイテム装備変更、耐久度判定機能含む）
    - [x] **task-7-4-4-2** 駐留軍団の出撃実行処理（駐留解除、マップ復帰）
- [ ] **task-7-5**: 拠点UI（拠点ActionMenu、施設サブメニュー、軍団編成画面）
  - [x] **task-7-5-1**: 拠点用ActionMenu実装（兵舎、生産工場、医療施設、倉庫）
  - [x] **task-7-5-2**: 兵舎サブメニュー実装（軍団編成、駐留軍団管理、待機兵士確認）
  - [x] **task-7-5-3**: 軍団編成画面統括実装（task-3-4-1、3-4-2、3-4-3の統合）
  - [x] **task-7-5-4**: 医療施設サブメニュー実装
    - [x] **task-7-5-4-1**: 医療施設UI作成（治療可能軍団リスト、治療中軍団表示）
    - [x] **task-7-5-4-2**: 治療システム実装（500両支払い、2分間のHP回復処理）
    - [x] **task-7-5-4-3**: 治療進行管理（リアルタイム処理、UIを閉じても継続）
    - [x] **task-7-5-4-4**: 治療完了通知システム
  - [x] **task-7-5-5**: 倉庫サブメニュー実装（在庫表示、アイテム詳細表示）

### 【エピック8】経済システム - 資金管理、収入、支出
**優先度**: 中

- [ ] **task-8-1**: 資金管理システム（所持金、収支計算）
- [ ] **task-8-2**: 収入システム（本拠地200両/分、占領拠点100両/分）
- [ ] **task-8-3**: 支出システム（生産費、医療費）
  - [ ] **task-8-3-1**: 医療費支払い処理（500両/軍団、資金不足チェック）
  - [ ] **task-8-3-2**: 生産費支払い処理（アイテムごとの費用、バッチ処理対応）

### 【エピック9】アイテム・装備システム - 武器、消耗品、耐久度
**優先度**: 中

- [x] **task-9-1**: アイテム基本システム（所持上限4個/人）
- [x] **task-9-2**: 武器システム（忍者刀、手裏剣、耐久度）
- [x] **task-9-3**: 持物管理システム
  - [x] **task-9-3-1**: 持物管理UI基盤実装（ActionMenu統合、ItemInventoryUI作成、ボタン配置）
  - [x] **task-9-3-2**: 消耗品使用機能実装（兵糧丸HP回復、薬忍スキル連携）
  - [x] **task-9-3-3**: 武器装備変更機能実装（装備/装備解除、装備中表示）
  - [x] **task-9-3-4**: アイテム譲渡機能

### 【エピック10】生産システム - アイテム生産、生産ライン、倉庫管理
**優先度**: 中

- [x] **task-10-1**: 生産開始フロー（生産指示〜キュー追加）
  - 拠点から生産工場を選択
  - アイテム選択UI（リスト表示、費用・リードタイム表示）
  - 数量指定UI（1〜99個、資金による制限）
  - キューへの追加（「0/指定数」形式で空きラインに追加）
- [x] **task-10-2**: 生産進行システム（バックグラウンド処理）
  - リアルタイム生産進行（UIを閉じても継続）
  - リードタイムで1個ずつ完成
  - 費用引き落とし（資金不足時の一時停止）
  - 倉庫への自動格納（完成即座に格納）
- [x] **task-10-3**: 進捗管理と完了処理
  - 「現在数/合計数」の更新表示
  - 進捗バー更新（現在作成中アイテムの進捗）
  - 残り時間表示（全体の推定完了時間）
  - 生産完了時の自動削除（キューから削除）
- [x] **task-10-4**: キャンセル機能
  - 手動キャンセルUI（×ボタン）
  - 既生産分の保持処理
- [x] **task-10-5**: 倉庫システム（軍団編成時の倉庫削除処理）
  - 軍団編成でアイテム装備確定時にInventoryManagerから削除

### 【エピック11】AIシステム - 敵行動パターン、軍団AI
**優先度**: 中

- [x] **task-11-0**: 敵軍団の基礎実装（静的配置）
- [ ] **task-11-1**: 基本AI行動（最寄り敵攻撃、撤退条件）
- [ ] **task-11-2**: 拠点攻略AI（中立拠点優先占領）
- [ ] **task-11-3**: 軍団自動編成・出撃AI

### 【エピック12】UI/UXシステム - 画面レイアウト、操作系統、情報表示
**優先度**: 中

#### オブジェクト別UI（既存UIコンポーネントの拡張）
- **task-12-4**: 軍団UIシステム
  - [x] **task-12-4-1**: 移動指示UI（ActionMenu、MovementModeMenu、経路指定）
  - [x] **task-12-4-2**: 軍団情報パネル（ArmyInfoPanel実装、詳細情報表示）
  - [x] **task-12-4-3**: 待機コマンド実装（ActionMenuに待機オプション追加、視界ボーナス）
  - [ ] **task-12-4-4**: アイテム使用UI（ItemUseMenu作成、アイテム選択・使用処理）
  - [ ] **task-12-4-5**: 駐留コマンド実装（拠点3マス以内判定、駐留オプション表示）
  - [ ] **task-12-4-6**: 敵軍団選択時のUI（発見済み敵軍団の情報表示）
  - [ ] **task-12-4-7**: 軍団選択時のビジュアルフィードバック強化（枠線、状態アイコン）
  - [x] **task-12-4-8**: 軍団情報パネルへの顔画像表示機能追加（左側に正方形顔画像、右側にステータス）
  - [ ] **task-12-4-9**: 攻撃目標指定UI（ActionMenuに攻撃目標指定オプション追加、目標選択モード）
- [x] **task-12-5**: 拠点UIシステム（BaseInfoPanel実装 - 拠点選択時の統一情報表示パネル）
- [ ] **task-12-6**: 地形UIシステム（シンプルなツールチップ表示）

#### システムUI
- [ ] **task-12-7**: システム情報バー（資金、収入、時間表示）
- [ ] **task-12-8**: ミニマップシステム
- [ ] **task-12-9**: ゲーム制御UI（ポーズ、速度調整）

### 【エピック13】ステージ・進行システム - キャンペーン構成、勝敗条件
**優先度**: 低

- [ ] **task-13-1**: ステージ管理システム（全6ステージ）
- [ ] **task-13-2**: 勝敗判定システム
- [ ] **task-13-3**: ステージ間引き継ぎシステム
- [ ] **task-13-4**: チュートリアルステージ実装

### 【エピック14】セーブ・ロードシステム - データ永続化、セーブスロット
**優先度**: 低

- [ ] **task-14-1**: セーブデータ構造定義
- [ ] **task-14-2**: セーブ・ロード機能（3スロット）
- [ ] **task-14-3**: オートセーブ機能
- [ ] **task-14-4**: クイックセーブ機能

## 開発推奨順序

1. **基盤システム** → ゲームの土台
2. **マップ・地形システム** → ゲームフィールドの実装
3. **キャラクター・軍団システム** → ゲームユニットの実装
4. **移動システム** → ユニットの基本操作
5. **戦闘システム** → コアゲームプレイ
6. **視界・発見システム** → 戦術的要素
7. **拠点管理システム** → 戦略的要素
8. **経済・アイテム・生産システム** → リソース管理
9. **AIシステム** → 対戦相手の実装
10. **UI/UXシステム** → ユーザビリティ向上
11. **ステージ・セーブシステム** → ゲーム進行管理