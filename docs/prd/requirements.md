# クリプト忍者咲耶コマンダー 要求定義書

## 1. ゲーム概要

### 1.1 基本情報
- **ゲームタイトル**: クリプト忍者咲耶コマンダー
- **ジャンル**: 2Dドット絵リアルタイムストラテジー（RTS）
- **プラットフォーム**: PCブラウザー
- **開発フレームワーク**: Phaser 3
- **画面解像度**: 1280x720（16:9）
- **フレームレート**: 30FPS目標
- **視点**: トップダウンビュー
- **アートスタイル**: 16bit風ドット絵（タイルサイズ: 16x16px）

### 1.2 世界観・ストーリー
- **舞台**: 現代の日本をモチーフにした架空の世界。忍者は普通の人にまじりつつ、コンビニのバイトなどをしながら、ひっそりと生活している
- **主人公**: クリプトニンジャ・咲耶（さくや）- 甲賀の女忍者
- **敵**: 風魔一族

### 1.3 ゲームの流れ

#### 1.3.1 基本的なゲームプレイの流れ
1. **準備フェーズ**
   - 拠点でアイテム（武器・消耗品）を生産
   - 倉庫から必要なアイテムを取り出し、兵士に装備
   - 軍団を編成（指揮官1名＋一般兵最大3名）

2. **展開フェーズ**
   - 編成した軍団を拠点から出撃
   - 移動指示を与えて戦場を展開
   - 中立拠点や敵拠点を占領し、収入源と生産拠点を確保

3. **戦闘フェーズ**
   - 敵軍団と遭遇時に自動的に交戦開始
   - 劣勢時は通常移動で撤退、または兵糧丸で回復
   - 拠点防衛時は新規軍団を出撃

4. **攻略フェーズ**
   - 敵本拠地へ向けて軍団を進軍
   - 敵本拠地のHPを0にして占領し、勝利を目指す
   - アイテム不足時は後方拠点で生産・補給を継続

## 2. コアゲームシステム

### 2.1 戦闘システム

#### 2.1.1 リアルタイム戦闘
- リアルタイムで進行（一時停止機能あり）
- 軍団単位での操作

#### 2.1.2 軍団編成（バトルコマンダー準拠）
- **軍団の定義**: 操作の基本単位
- 1軍団 = 1指揮官+3人の一般忍者（合計4人）
- 最大同時出撃軍団数: 6軍団
- **軍団構成**:
  - 指揮官：1名（必須）- いずれかのクラスの忍者
  - 一般兵：3名 - 任意のクラスの忍者
- **軍団と個人の関係**:
  - 移動：軍団単位で行動（4人が一緒に移動）
  - HP：各メンバーが個別にHPを持つ
  - 戦闘：各メンバーが個別に攻撃を行う
  - 撃破：HPが0になったメンバーは消滅し、そのステージでは再出撃不可
  - 軍団消滅条件：軍団の構成員が0名になった時点
- **軍団能力値の決定**:
  - 移動速度：構成メンバーの移動速度の平均値
  - 視界：各メンバーが各々視界を持ち、敵を発見できる

#### 2.1.3 移動・戦闘モード

| モード | 移動速度 | 攻撃可否 | 視界補正 | 説明 |
|--------|----------|----------|----------|------|
| 通常移動 | 100% | 不可 | ±0マス | 高速移動、撤退時に使用 |
| 戦闘移動 | 60% | 可能 | ±0マス | 攻撃しながら移動 |
| 待機 | 0% | 可能 | +1マス | その場で待機し迎撃 |

#### 2.1.4 移動指示システム（バトルコマンダー準拠）

##### 移動指示の操作フロー
1. **軍団選択**: 移動させたい軍団の指揮官を左クリックで選択する。マウスホバーした際、クリッカブルなことがわかる演出をいれる(マウスポインタを手マークするなど)。選択された指揮官は視覚的に識別できるようにする
2. **行動選択**: 
   - 指揮官選択時、利用可能な行動のメニューが表示される
   - 「移動」と「待機」が選択可能（今後、他の行動を追加予定）
   - メニュー外をクリックすると選択をキャンセルできる
3. **移動モード選択**: 
   - 「移動」を選択すると、移動方法を選ぶメニューが表示される
   - 「通常移動」（高速移動、攻撃不可）または「戦闘移動」（低速移動、攻撃可能）を選択できる
   - 選択後、経路指定にうつるまで1s待つ。(経路指定のクリックをしてしまうため)
4. **経路指定**: 
   - マップ上をクリックして最大4地点まで経路を指定できる
   - 選択した地点には順番がわかるマーカーが表示される
   - 各地点は直線で結ばれ、経路が視覚的に確認できる
   - 軍団は指定した経路通りに移動する（自動的な最短経路探索は行わない）
   - 経路指定中にキャンセルした場合
    - 1箇所でも地点が選択されていれば、現在指定した経路で移動を開始する
    - まだ1箇所も地点が選択されていなければ、移動指定のキャンセルとみなし、今の行動を継続する
5. **移動開始**: 
   - 経路指定が完了すると、マーカーが消えて軍団が自動的に移動を開始する
   - 移動中も軍団の選択状態は維持される

##### 移動速度計算
```
軍団移動速度 = (指揮官の移動速度 + 一般忍者3名の移動速度合計) ÷ 軍団人数

実際の移動時間（秒/マス） = (40 / 軍団移動速度) × (1 / モード補正) × 地形コスト

例1：風忍指揮官（移動速度13）+ 混成部隊（移動速度10、12、13）の軍団
軍団移動速度 = (13 + 10 + 12 + 13) ÷ 4 = 12
通常移動で平地を通過 = (40 / 12) × (1 / 1.0) × 1.0 = 3.33秒/マス

例2：鉄忍指揮官（移動速度8）+ 混成部隊（移動速度10、11、12）の軍団
軍団移動速度 = (8 + 10 + 11 + 12) ÷ 4 = 10.25
戦闘移動で森林を通過 = (40 / 10.25) × (1 / 0.6) × 1.5 = 9.76秒/マス
```

#### 2.1.5 軍団編成システム（バトルコマンダー準拠）

##### 軍団編成フロー
1. **拠点選択**: 兵士がいる拠点をクリックで選択
2. **出撃コマンド**: コマンドメニューから「出撃」を選択
3. **軍団編成画面への遷移**: 
   - 画面が軍団編成モードに切り替わる
   - 拠点に待機中の兵士一覧が表示される
4. **指揮官選択**: 
   - 待機中の任意の忍者から1名を選択（必須）
   - 指揮官がいない場合は編成不可
5. **一般兵選択**: 
   - 残りの待機中忍者から最大3名まで選択
   - 最小1名、最大3名の選択が可能
6. **アイテム装備**:
   - 各メンバーに倉庫からアイテムを配布（最大4個/人）
   - 武器は上にあるものが自動装備される
   - 装備画面で個別に装備変更も可能
7. **出撃位置選択**:
   - 拠点の上下左右1マス（4方向）から選択
   - 選択した方向の2マス先に軍団を配置
   - 他の軍団や障害物がある場所は選択不可
8. **軍団出撃**: 
   - 「出撃」ボタンで軍団が指定位置に配置される
   - 編成した兵士は拠点の待機リストから除外される

##### 編成制限
- 同一の兵士を複数の軍団に所属させることは不可
- 指揮官は必ず1名必要（指揮官なしでは編成不可）
- 拠点に兵士がいない場合は出撃不可

#### 2.1.6 地形効果（簡略版）

| 地形タイプ | 移動コスト | 防御補正 | 攻撃補正 | 視界補正 |
|-----------|------------|----------|----------|----------|
| 平地 | 1.0 | +0% | +0% | ±0マス |
| 森林 | 1.5 | +20% | -10% | -2マス |
| 山地 | 2.0 | +30% | +15% | +3マス |

#### 2.1.7 戦闘計算式（バトルコマンダー準拠） https://battle-commander.nkden.com/know-hows/

##### 基本戦闘メカニクス
- **攻撃単位**: 軍団内の生存メンバー全員が個別に攻撃
- **攻撃タイミング**: 各メンバーの速さに応じた間隔で自動攻撃
- **目標選択**: 
  - 攻撃目標が指定されている場合：指定された目標のみを攻撃
  - 攻撃目標が未指定の場合：攻撃者から最も近い発見済み敵キャラクターを選択（同距離の場合はランダム）
- **ダメージ**: 攻撃成功時、対象メンバーのHPを1減少

##### 戦闘計算式
```
ダメージ量 = 1（固定値）
攻撃成功率 = (攻撃側の攻撃力 + 武器補正) / (攻撃側の攻撃力 + 武器補正 + 防御側の防御力) × 100%
攻撃間隔 = 90 / 速さ（秒）

各メンバーの攻撃力・防御力・速さ：
- 各メンバーが自身のステータスを使用

例1：攻撃力30のメンバーが攻撃する場合
- 防御力10の敵: 成功率75%
- 防御力30の敵: 成功率50%  
- 防御力70の敵: 成功率30%

例2：攻撃間隔の計算
- 速さ20の忍者: 4.5秒に1回攻撃
- 速さ16の忍者: 5.625秒に1回攻撃
- 速さ15の忍者: 6秒に1回攻撃
```

#### 2.1.8 攻撃範囲・射程

| 武器タイプ | 最小射程 | 最大射程 | 攻撃範囲 |
|-----------|----------|----------|----------|
| 刀 | 1 | 3 | 単体 |
| 手裏剣 | 1 | 6 | 単体 |
| 弓 | 4 | 12 | 単体 |

#### 2.1.9 視界システムと発見メカニクス

##### 視界の基本ルール
- **視界範囲**: 各メンバーが個別の視界を持つ（職業とモードにより決定）
- **視界共有**: 全軍団間で視界を共有
- **発見状態**: 
  - 未発見: 敵軍団の位置・状態が不明（マップ上に表示されない）
  - 発見済み: 敵軍団の位置・状態が判明（マップ上に表示される）

##### 発見メカニクス
1. **初期状態**:
   - 全ての敵軍団は「未発見」状態でスタート
   - 敵軍団は見えない状態で移動し、本拠地制圧を目指す

2. **発見条件**:
   - 味方ユニットの視界範囲に敵ユニットが入る
   - 発見は軍団内の任意のメンバーの視界で成立
   - 一度発見された敵軍団は、視界外に出ても表示継続

3. **戦闘との関係**:
   - 未発見の敵は攻撃対象にできない
   - 発見済みの敵のみが攻撃対象となる
   - 敵軍も同じロジックで味方を発見・攻撃

4. **戦術的意味**:
   - 未発見状態を維持すれば、敵陣深くへの潜入が可能
   - 視界の広い影忍を偵察に使う戦術が有効
   - 森林地形（視界-2マス）を利用したステルス移動

##### 視界計算
```
実効視界 = 基本視界 + クラスボーナス + モード補正 + 地形補正

例：影忍（基本視界8）が山地（+3マス）で待機（+1マス）
実効視界 = 8 + 0 + 1 + 3 = 12マス
```

#### 2.1.10 攻撃システム詳細

##### 攻撃の流れ
1. **攻撃条件確認**:
   - 装備武器の耐久度が1以上
   - 射程内に敵が存在
   - 戦闘移動または待機モード中

2. **攻撃ターゲット決定**:
   - 攻撃者から最も近い発見済み敵キャラクターを選択
   - 未発見の敵は攻撃対象にならない
   - 同距離の場合はランダムに選択

3. **攻撃間隔**:
   ```
   攻撃間隔（秒） = 90 / 速さ
   
   例：速さ20の忍者 = 4.5秒に1回攻撃
   例：速さ15の忍者 = 6秒に1回攻撃
   ```

4. **攻撃実行**:
   - 刀剣：斬撃エフェクトが敵に向かって飛ぶ
   - 飛び道具：手裏剣が放物線を描いて飛ぶ

5. **命中判定**:
   - 戦闘計算式に基づいて命中判定
   - 命中時：敵に爆発エフェクト表示

6. **耐久度消費**:
   - 攻撃成功/失敗に関わらず武器の耐久度-1
   - 耐久度0になった武器は使用不可

##### アイテム所持システム
- **所持上限**: 各メンバー最大4アイテム
- **アイテム種別**:
  - 武器（刀剣/飛び道具）：戦闘に使用
  - 消耗品（兵糧丸等）：HP回復等に使用
- **装備**: 武器は上にあるものが自動装備される。個別に装備を変更することも可能

##### 攻撃エフェクト仕様
- **斬撃（刀剣）**:
  - 発生位置：攻撃者の位置
  - 移動：敵に向かって直線移動
  - 速度：2マス/秒
  - 見た目：白い弧状の軌跡
- **手裏剣（飛び道具）**:
  - 発生位置：攻撃者の位置
  - 移動：敵に向かって直線移動
  - 速度：2マス/秒
  - 見た目：回転しながら飛ぶ手裏剣
- **ヒットエフェクト**:
  - 命中時：赤い爆発エフェクト（0.3秒）

#### 2.1.11 攻撃目標指定システム

##### 目標指定の概要
- **基本機能**: 軍団ごとに特定の攻撃目標を指定可能
- **優先攻撃**: 目標が指定されている場合、他の敵は無視して指定目標のみを攻撃
- **自動解除**: 目標が消滅した場合は通常の自動戦闘に戻る

##### 目標の種類
- **敵軍団**: 特定の敵軍団を攻撃目標に指定
- **拠点**: 敵拠点や中立拠点を攻撃目標に指定

##### 攻撃目標指定の操作フロー
1. **軍団選択**: 味方軍団の指揮官を左クリックで選択
2. **行動メニュー表示**: ActionMenuが表示され、「攻撃目標指定」オプションが選択可能
3. **目標指定モードへの遷移**:
   - 「攻撃目標指定」を選択すると、ArmyInfoPanelが自動的に閉じる
   - ゲームが「攻撃目標指定モード」に移行する
   - この状態では、通常のオブジェクト選択処理が一時的に無効化される
4. **目標の選択**:
   - 発見済みの敵軍団の指揮官をクリックして攻撃目標に指定
   - 目標指定時に「攻撃目標を指定しました」というメッセージを表示
   - 目標指定モード中は、敵軍団をクリックしても通常の情報表示は行われない
5. **目標指定の完了**:
   - 目標が指定されると、自動的に通常モードに戻る
   - 指定した軍団は、選択した敵軍団のみを優先的に攻撃する
6. **キャンセル操作**:
   - 目標指定モード中に右クリックでキャンセル可能
   - キャンセル時は目標を指定せずに通常モードに戻る

##### UIの挙動
- **目標指定モード中の表示**:
  - 画面上部に「攻撃目標を選択してください」というガイドメッセージ
- **目標指定後の表示**:
  - ArmyInfoPanel内に現在の攻撃目標情報を表示
    - 状態の右横に横並びで表示すること

##### 目標選択の優先順位
```
if (攻撃目標が指定されている) {
  if (指定目標が射程内に存在) {
    指定目標を攻撃
  } else {
    攻撃しない（待機）
  }
} else {
  通常の目標選択ロジック（最も近い敵）
}
```

##### 目標解除条件
- 指定した軍団が全滅
- プレイヤーが手動で解除（軍団選択後、「攻撃目標解除」コマンド）
- 指定した拠点が占領された（将来実装）

#### 2.1.12 持物管理システム

##### 持物管理の概要
軍団の各メンバーが所持するアイテムを確認・操作するシステム。消耗品の使用、武器の装備変更、将来的にはアイテムの譲渡機能を提供する。

##### 持物管理フロー
1. **軍団選択時のActionMenu**
   - 既存の選択肢に「持物」オプションを追加
   - 「移動」「待機」「攻撃目標指定」「駐留」「持物」

2. **持物選択UI**
   - 「持物」選択で専用UIに遷移
   - 軍団メンバーの個人持物を表示
   - 左右矢印でキャラクター切り替え（ページネーション）
   - 各アイテムに3つの操作ボタンを表示：
     - 「使用」ボタン
     - 「装備」ボタン
     - 「渡す」ボタン

   - デザイン

+------------------------------------+
|               持物                  |
| <         キャラクター名            > |
| 1. 忍者刀(60/100)   使用  装備中 わたす|
| 2. 兵糧丸           使用  装備   わたす|
| 3. 空きスロット                      |
| 4. 空きスロット                      |
|              とじる                 |
+------------------------------------+

※ < > はページネーション。次のキャラクターに切り替え
※ とじる か 枠外クリックでUIを閉じる

3. **アイテムタイプ別のボタン有効/無効状態**

| アイテムタイプ | 使用 | 装備 | 渡す |
|--------------|------|------|------|
| 消耗品 | ✅有効 | ❌無効（グレーアウト） | ❌未実装（グレーアウト） |
| 武器（未装備） | ❌無効（グレーアウト） | ✅有効 | ❌未実装（グレーアウト） |
| 武器（装備中） | ❌無効（グレーアウト） | 「装備中」表示 | ❌未実装（グレーアウト） |

4. **消耗品使用処理**
   - 「使用」ボタンで即座に自分に効果適用
   - 兵糧丸：使用者のHP全快
   - 薬忍の場合：軍団全員のHP全快
   - 使用後、アイテムは消費され持物から削除

5. **装備変更処理**
   - 「装備」ボタンで武器を装備
   - 既に装備中の武器は自動的に装備解除
   - 装備中の武器は「装備中」と表示

6. **UI操作仕様**
   - 右クリックまたは画面外クリックでキャンセル
   - 使用後は持物UIに留まる（連続使用可能）
   - ESCキーで通常画面に戻る

### 2.2 キャラクターシステム

#### 2.2.1 能力値パラメータ

| パラメータ | 説明 | 最小値 | 最大値 |
|-----------|------|--------|--------|
| HP | 体力 | 20 | 100 |
| 攻撃力 | 物理攻撃力 | 5 | 100 |
| 防御力 | 物理防御力 | 3 | 100 |
| 速さ | 行動速度 | 5 | 50 |
| 移動速度 | 移動能力値（高いほど速い） | 3 | 30 |
| 視界 | 視認可能範囲（マス） | 3 | 20 |

#### 2.2.2 職業（クラス）

**風忍（かぜにん）** - 機動力特化
- **クラス特性**: 移動速度に優れる
- **クラススキル**: 疾風（移動速度+10%）

**鉄忍（てつにん）** - 防御特化  
- **クラス特性**: 高い防御力と体力
- **クラススキル**: 鉄壁（防御力+20%）

**影忍（かげにん）** - ステルス特化
- **クラス特性**: 視界に優れる
- **クラススキル**: 暗視（視界範囲+3）

**薬忍（くすりにん）** - 支援特化
- **クラス特性**: 回復に特化
- **クラススキル**: 医術（兵糧丸を使うと軍団全員に効果が及ぶ）

#### 2.2.3 キャラクタービジュアル
- **顔画像**: 各キャラクターは個別の正方形の顔画像を持つ
- **顔画像の命名規則**: `{CharacterName}Face.png` または `.jpg`
- **表示場所**: 軍団情報パネル内での個別メンバー表示時（左側に顔画像、右側にステータス）
- **注記**: 顔画像は職業ではなく、個々のキャラクターに紐付けられる

### 2.3 装備・アイテムシステム

#### 2.3.1 アイテム所持・装備システム
- **所持上限**: 各メンバーが最大4アイテムまで所持可能
- **装備可能数**: 武器は1つのみ装備可能
- **アイテム管理**: 
  - 軍団編成時にアイテムを配布
  - ステージ中はアイテムの受け渡し不可
  - 耐久度0の武器も所持枠を占有

#### 2.3.2 武器システム

| カテゴリ | 武器例 | 攻撃力補正 | 射程 | 耐久度 | 価格 |
|----------|--------|-----------|------|--------|------|
| 刀剣 | 忍者刀 | +15 | 3マス | 100 | 300両 |
| 飛び道具 | 手裏剣 | +5 | 6マス | 100 | 200両 |
| 飛び道具 | 弓 | +2 | 12マス | 100 | 400両 |

##### 武器特性
- **刀剣**: 
  - 近距離攻撃
  - 斬撃エフェクト
  - 地形の影響を受けない
- **飛び道具**: 
  - 遠距離攻撃

#### 2.3.3 消耗品アイテム

| アイテム | 効果 | 使用回数 | 価格 |
|----------|------|----------|------|
| 兵糧丸 | HP全快 | 1回 | 50両 |

##### 消耗品の使用方法
- **戦闘中使用**: 軍団選択後、アイテム使用コマンドで使用
- **使用対象**: 使用した兵士のみHP全快（薬忍は軍団全員）
- **使用タイミング**: 移動中・戦闘中いつでも使用可能

## 3. ゲーム進行システム

### 3.1 ステージ構成

#### 3.1.1 キャンペーンモード
- **全3章構成**（各章2ステージ = 合計6ステージ）
- **難易度**: 固定（バランス調整済み）

#### 3.1.2 ステージ設計
- **マップサイズ**: 512*512
- **勝利条件**: 
  - 敵の本拠地を占領する
  - 占領方法：敵本拠地のHPを0にし、隣接軍団で「占領」コマンドを実行
- **敗北条件**: 
  - 全軍団が消滅（指揮官が全員撃破）
  - 咲耶（主人公）が撃破された場合
  - 味方本拠地が敵に占領された場合

### 3.2 ステージ進行例

#### チュートリアル章
1. **ステージ1**: 基本操作
   - 移動と戦闘の基礎
   
2. **ステージ2**: 地形効果
   - 森林と山地を使った戦術

#### 第一章：初陣
1. **ステージ3**: 平原の戦い
2. **ステージ4**: 森林防衛戦

#### 第二章：決戦
1. **ステージ5**: 山岳戦
2. **ステージ6**: 最終決戦

## 4. AI システム

### 4.1 敵AI行動パターン
- **軍団行動**: 最も近い敵軍団を攻撃
- **撤退条件**: 
  - 軍団の生存メンバーが1名になったら撤退
  - 指揮官のHPが30%以下で撤退
- **軍団編成**: 敵本拠地・占領拠点から定期的に自動出撃
- **拠点攻略**: 中立拠点を優先的に占領
- 地形効果を基本的に考慮しない

## 5. UI/UX 詳細設計

### 5.1 UI設計方針
本ゲームのUIはオブジェクト指向UI（OOUI）の原則に基づいて設計する。
- **オブジェクト優先**: タスクではなく、オブジェクトを中心にUIを構成
- **選択→操作**: オブジェクトを選択してから、可能な操作を表示
- **一貫性**: 全てのオブジェクトタイプで同じ操作フローを維持

#### 実装アプローチ
- **既存コンポーネントの拡張**: UIManager、ActionMenu、MovementModeMenuなど既存のUIコンポーネントを活用
- **段階的実装**: 必要な機能から順次追加し、実用性を重視
- **個別最適化**: 各オブジェクトタイプ（軍団、拠点、地形）に対して最適なUI実装

#### UIの表示方式
- **固定位置UI**: 画面に固定されたUI要素
  - カメラの表示範囲（worldView）を基準に配置
  - カメラのスクロールに追従して位置を更新
  - ズームレベルに関係なく画面の特定位置に固定
  - 例：ArmyInfoPanel（右側）、ActionMenu（左側）、MovementModeMenu（左側）、システム情報
- **ワールド座標UI**: ゲーム世界に配置されるUI要素
  - ゲームオブジェクトの位置に相対的に配置
  - カメラのスクロールとズームの影響を受ける
  - 例：WaypointMarker（経路マーカー）

### 5.2 画面レイアウト

```
+------------------+------------------+
|                  | オブジェクト情報  |
|    メイン        | パネル           |
|    ビュー        | ・選択オブジェクト |
|                  | ・属性/状態       |
|                  | ・可能な操作      |
+------------------+------------------+
| オブジェクト      | システム情報      |
| 操作パネル        | (資金/収入/時間)  |
+------------------+------------------+
```

### 5.3 オブジェクトタイプと操作

#### 5.3.1 味方軍団オブジェクト
**表示情報**:
- 指揮官と構成メンバー
- 各メンバーの顔画像（正方形、キャラクター固有、左側配置）
- 各メンバーのHP/最大HP（顔画像の右側に配置）
- 装備アイテム一覧
- 現在の状態（移動中/戦闘中/待機中）
- 現在位置

**可能な操作**:
- 移動指示（通常移動/戦闘移動）
- 待機
- 攻撃目標指定（敵軍団を選択）
- アイテム使用
- 駐留（拠点から3マス以内の場合のみ）
- 詳細情報表示

#### 5.3.2 敵軍団オブジェクト
**表示情報**（発見済みの場合のみ）:
- 可視メンバー数
- 推定HP状況
- 移動状態
- 現在位置

**可能な操作**:
- 詳細情報表示（可視情報のみ）

#### 5.3.3 拠点オブジェクト

##### 拠点情報パネル（BaseInfoPanel）の仕様
- **表示位置**: 画面右側（ArmyInfoPanelと同じ位置）
- **表示タイミング**: 拠点をクリックした時
- **閉じる方法**: パネル外をクリック、または右クリック

##### 表示情報（全拠点共通）
- 拠点名
- 所属（「味方拠点」「中立拠点」「敵拠点」）
- HP/最大HP
- 防御力
- 収入（味方：200両/分 or 100両/分、中立・敵：100両/分）

**内部施設**（味方拠点の場合）:
- **兵舎**: 待機兵士管理、軍団編成・解散
- **生産工場**: アイテム生産管理
- **医療施設**: 駐留軍団の治療
- **倉庫**: アイテム在庫管理

**可能な操作**:
- 詳細情報表示（拠点情報パネルに上記の情報を表示）
- 施設を選択して利用（味方拠点の場合、別途実装）

##### 味方拠点の操作フロー
1. **拠点選択**: 味方拠点を左クリックで選択
2. **行動メニュー表示**: ActionMenuが表示され、利用可能な施設が選択可能
   - 兵舎
   - 生産工場
   - 医療施設
   - 倉庫
3. **施設選択**: 
   - 施設を選択すると、各施設のサブメニューが表示される
   - メニュー外をクリックすると選択をキャンセルできる
4. **兵舎選択時のサブメニュー**:
   - 軍団編成
   - 駐留軍団管理
   - 待機兵士確認

#### 5.3.4 地形オブジェクト（空地）
**表示情報**:
- 地形タイプ（平地/森林/山地）
- 移動コスト
- 戦闘補正（防御/攻撃/視界）

**可能な操作**:
- 詳細情報表示

### 5.4 操作系統

#### 5.4.1 基本操作
- **左クリック**: オブジェクト選択、操作実行
- **右クリック**: 選択解除、操作キャンセル、前の画面に戻る
- **マウスポインタ**: クリック可能なオブジェクト上で手のマークに変化

#### 5.4.2 操作フロー
1. **オブジェクト選択**: マップ上のオブジェクトを左クリック
2. **情報表示**: オブジェクト情報パネルに詳細表示
3. **操作選択**: 可能な操作から選択
4. **操作実行**: パラメータ指定後、実行

### 5.5 拠点内施設UI

#### 5.5.1 兵舎
**機能**: 待機兵士の管理と軍団編成
```
+------------------+------------------+------------------+
| 待機兵士リスト    | 編成中軍団       | 駐留軍団リスト    |
| [兵士オブジェクト] | 指揮官: [選択]   | [軍団オブジェクト] |
| ・風忍A          | 一般兵:          | ・咲耶軍団        |
| ・鉄忍B          | 1. [選択]        | ・太郎軍団        |
| ・影忍C          | 2. [選択]        |                  |
| ・薬忍D          | 3. [選択]        | 選択軍団操作:     |
|                  |                  | [解散] [出撃]     |
+------------------+------------------+------------------+
```

#### 5.5.2 生産工場
**機能**: アイテムの生産管理
```
+------------------+------------------+
| 生産可能アイテム  | 生産ライン        |
| ・忍者刀(300両)  | 1. 忍者刀 (45秒)  |
| ・手裏剣(200両)  | 2. 手裏剣 (30秒)  |
| ・兵糧丸(50両)   | 3. [空き]         |
|                  | 4. [空き]         |
| [選択アイテム    | 5. [空き]         |
|  の生産を追加]   | 6. [空き]         |
+------------------+------------------+
```

#### 5.5.3 医療施設
**機能**: 駐留軍団の治療
```
+------------------+------------------+
| 治療可能軍団      | 治療中            |
| ・咲耶軍団(HP低下) | 三郎軍団          |
| ・太郎軍団(HP低下) | 残り時間: 1分30秒 |
|                  | 費用: 500両       |
| [選択軍団の      |                  |
|  治療を開始]     |                  |
+------------------+------------------+
```

#### 5.5.4 倉庫
**機能**: アイテム在庫の確認と管理
```
+------------------+------------------+
| アイテム在庫      | 選択アイテム詳細  |
| ・忍者刀 x12     | 忍者刀           |
| ・手裏剣 x25     | 攻撃力: +15      |
| ・兵糧丸 x30     | 射程: 1-3マス     |
|                  | 耐久度: 100      |
|                  | 価格: 300両      |
+------------------+------------------+
```

### 5.6 情報パネルの動的表示
選択したオブジェクトタイプに応じて、情報パネルの内容が自動的に切り替わる。
- 未選択時: ゲーム全体の状況サマリー
- 軍団選択時: 軍団詳細情報と操作メニュー
- 拠点選択時: 拠点情報と施設メニュー
- 地形選択時: 地形効果の詳細

### 5.7 ミニマップ
画面右上に配置し、以下の情報を表示：
- マップ全体の縮小表示
- 味方/敵軍団の位置（発見済みのみ）
- 拠点の位置と所属
- 現在の視界範囲

## 6. 拠点・内政システム

### 6.1 拠点システム

#### 6.1.1 拠点の概念
拠点は複数の施設を持つ戦略拠点として機能する。各拠点は施設の集合体として構成され、プレイヤーは拠点内の各施設を選択して利用する。

#### 6.1.2 拠点の種類
- **味方本拠地**: プレイヤーの初期拠点
  - 全施設が利用可能
  - 失陥すると敗北
- **中立拠点**: 未占領の拠点
  - 占領後は占領側の拠点として機能
- **味方占領拠点**: 味方が占領した拠点
  - 全施設が利用可能
  - 追加の収入源
- **敵占領拠点**: 敵が占領した拠点
  - 敵の軍団編成・生産拠点
- **敵本拠地**: 敵の初期拠点
  - 占領すると勝利

#### 6.1.3 拠点内施設
味方拠点には以下の施設が存在し、それぞれ独立した機能を持つ：

##### 兵舎
- **機能**: 兵士と軍団の管理
- **利用可能な操作**:
  - 待機兵士の確認
  - 新規軍団の編成（指揮官1名＋一般兵最大3名）
  - 駐留軍団の解散
  - 駐留軍団の出撃指示

##### 生産工場
- **機能**: アイテムの生産
- **利用可能な操作**:
  - 生産アイテムの選択（忍者刀、手裏剣、兵糧丸）
  - 生産ラインの管理（最大6ライン）
  - 生産状況の確認

##### 医療施設
- **機能**: 負傷した軍団の治療
- **利用可能な操作**:
  - 駐留軍団の治療（500両で2分間の全回復）
  - 治療中軍団の確認
  - 治療完了通知

##### 倉庫
- **機能**: アイテムの保管と管理
- **利用可能な操作**:
  - 在庫アイテムの確認
  - 駐留軍団へのアイテム配布
  - アイテム詳細情報の表示

#### 6.1.4 拠点の基本属性
- **HP**: 各拠点は固定HPを持つ
  - 本拠地: 200HP
  - 通常拠点: 80HP
- **収入**: 占領した拠点から定期的に資金を獲得
  - 本拠地: 200両/分
  - 占領拠点: 100両/分

#### 6.1.5 拠点戦闘システム
- **拠点への攻撃**:
  - 軍団が拠点を攻撃目標に選択可能
  - 通常の戦闘と同じ計算式で攻撃
  - 拠点は反撃しない

#### 6.1.6 拠点占領システム
- **占領条件**:
  - 拠点のHPが0になる
  - 3マス以内の軍団が占領を実行
- **占領効果**:
  - 拠点のHPが占領軍団の合計HPまで回復
  - 占領軍団は自動的に駐留状態になる
  - 拠点の所属と利用可能施設が占領側に変更
- **占領時の処理**:
  - 拠点内の敵兵士は全員撃破扱い
  - 生産中のアイテムは破棄

#### 6.1.7 駐留システム
- **駐留条件**: 味方拠点から3マス以内にいる味方軍団
- **駐留軍団の状態**:
  - 拠点内に待機し、各施設を利用可能
  - 医療施設での治療が可能
  - 倉庫からのアイテム補給が可能
  - **治療中の制限**: 治療中の軍団は出撃不可（駐留管理でアイテム装備への遷移が無効化される）
- **駐留解除**: 兵舎から出撃指示を出すことで拠点周囲2マスに配置
  - 治療中の軍団は駐留解除不可
  - 駐留管理画面では治療中の軍団名の後ろに「治療中」と表示

##### 駐留操作フロー
1. **軍団選択**: 駐留させたい軍団の指揮官を左クリックで選択
2. **駐留コマンド選択**: ActionMenuから「駐留」を選択
   - 3マス以内に味方拠点がない場合はグレーアウト表示
3. **拠点選択モードへの遷移**:
   - 「駐留」を選択すると、拠点選択モードに移行
   - 3マス以内の味方拠点がハイライト表示される
   - 画面上部に「駐留先の拠点を選択してください」というガイドメッセージ
4. **拠点選択**:
   - ハイライトされた拠点をクリックして駐留先を選択
   - 選択可能な拠点は3マス以内の味方拠点のみ
5. **駐留実行**:
   - 拠点を選択すると軍団が拠点に移動し、駐留状態になる
   - 「軍団を拠点に駐留させました」というメッセージを表示
6. **キャンセル操作**:
   - 拠点選択モード中に右クリックでキャンセル可能
   - キャンセル時は駐留せずに通常モードに戻る

### 6.2 経済システム

#### 6.2.1 資金管理
- **初期資金**: 3000両
- **収入源**:
  - 本拠地: 200両/分（基本収入）
  - 占領拠点: 100両/分（追加収入）
- **支出項目**:
  - アイテム生産費: 各アイテムごとに設定
  - 兵士雇用: ステージ間でのみ可能
  - 入院費用: 500両（軍団全回復）

#### 6.2.2 収支表示
- 現在の所持金
- 収入/分の表示
- 生産中アイテムの予約費用

### 6.3 アイテム生産システム

#### 6.3.1 生産基本仕様
- **生産可能拠点**: 本拠地および占領した拠点
- **生産ライン**: 各拠点で独立した生産ラインを管理。1拠点6ラインまで
- **共通倉庫**: 生産完了したアイテムは全拠点共通の倉庫に格納
- **同時生産**: 複数の拠点で並行して生産可能
- **バックグラウンド処理**: UIを閉じても生産は継続される
- **リードタイム制**: アイテムごとに1個あたりの生産時間が設定され、時間経過で1個ずつ完成

#### 6.3.2 生産可能アイテム

| アイテム | カテゴリ | 生産費用 | 生産時間 | 説明 |
|----------|----------|----------|----------|------|
| 忍者刀 | 武器 | 300両 | 60秒 | 刀剣系武器、耐久度100 |
| 手裏剣 | 武器 | 200両 | 80秒 | 飛び道具、耐久度100 |
| 弓 | 武器 | 400両 | 100秒 | 飛び道具、耐久度100 |
| 兵糧丸 | 消耗品 | 50両 | 120秒 | HP全快アイテム |

#### 6.3.3 生産フロー
1. **生産指示**: 拠点選択後、「生産」コマンドを選択
2. **アイテム選択**: 生産可能アイテムリストから選択
3. **数量指定**: 生産数を指定（最大99個）
4. **キューへの追加**: 空いているラインに「0/指定数」として追加
5. **生産進行**: リアルタイムで生産が進行（UIを閉じても継続）
6. **個別完成**: リードタイム経過ごとに1個ずつ完成
7. **費用支払**: 1つ生産されるたびにお金が減る。お金が足りない場合生産されない
8. **倉庫格納**: 完成品は即座に共通倉庫へ自動格納
9. **キュー更新**: 「現在生産数/生産指示合計数」が更新される（例：5/20）
10. **自動削除**: 生産指示合計数に達したらキューから自動削除
11. **手動キャンセル**: 生産途中でもキューを削除可能（既生産分は倉庫に残る、確認なしで即実行）

#### 6.3.4 生産管理UI
- **生産ライン表示**: 
  - 各ラインに「アイテム名 現在生産数/合計数」形式で表示（例：「忍者刀 5/20」）
  - 現在作成中アイテムの進捗バー（0-100%）
  - 残り時間表示（全体の推定完了時間）
  - キャンセルボタン（×）で手動削除可能
- **倉庫在庫**: 現在の在庫数表示
- **生産可能アイテムリスト**: 
  - アイテム名、費用、リードタイムを表示
  - 資金不足のアイテムはグレーアウト
- **空きライン表示**: 使用していないラインは「[空き]」と表示

### 6.4 軍団管理
- **待機兵士システム**:
  - 拠点には待機中の兵士が存在
  - 軍団に編成されていない兵士は拠点で待機
  - 撃破された兵士はそのステージでは復活不可
- **ステージ間管理**:
  - ステージクリア後、撃破された兵士も含め全兵士 次ステージに引き継ぎ
  - 新規兵士の雇用が可能（資金が必要）

## 7. システム要件

### 7.1 性能要件
- **目標FPS**: 30
- **最大同時軍団**: 25軍団（100体÷4人）

### 7.2 セーブ機能
- **セーブスロット**: 3つ
- **オートセーブ**: ステージクリア時
- **クイックセーブ**: 戦闘中可能
- **保存項目**: 
  - ゲーム進行状況
  - 所持金
  - 生存兵士の情報
  - クリア済みステージ

この簡略化された仕様により、コアゲームプレイの検証が可能になります。