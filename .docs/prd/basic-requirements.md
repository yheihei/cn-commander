# クリプト忍者咲耶コマンダー ゲーム要求定義書

## 1. ゲーム概要

コンセプト: バトルコマンダーライクなゲームを作りたい https://battle-commander.nkden.com/know-hows/

### 1.1 基本情報
- **ゲームタイトル**: クリプトニンジャRTS（仮）
- **ジャンル**: 2Dドット絵リアルタイムストラテジー
- **プラットフォーム**: Phaser（PCブラウザー向け）
- **視点**: トップダウンビュー
- **アートスタイル**: 16bit風ドット絵

### 1.2 世界観・ストーリー
- **舞台**: 戦国時代の日本をモチーフにした架空の世界
- **主人公**: クリプトニンジャと呼ばれる忍者たち
- **クラン**:
  - 風魔（ふうま）: 敵。風と嵐を操る一族
  - 甲賀（こうが）: 主人公一族

## 2. コアゲームシステム

### 2.1 戦闘システム

#### 2.1.1 リアルタイム戦闘
- **基本仕様**:
  - リアルタイムで進行（一時停止機能あり）
  - ユニット単位での操作

#### 2.1.2 ユニット編成
- **編成ルール**:
  - 1ユニット = 1指揮官 + 最大3名の忍者

#### 2.1.3 移動コマンド
- **通常移動**: 高速移動、戦闘不可
- **戦闘移動**: 低速移動、戦闘可能
- **戦闘待機**: その場で待機、戦闘可能
- **待機**: 完全待機、戦闘不可

#### 2.1.4 地形効果
| 地形タイプ | 移動速度 | 防御効果 | 特殊効果 |
|-----------|---------|----------|----------|
| 平地 | 100% | なし | - |
| 森林 | 70% | +20% | 視界制限 |
| 山地 | 50% | +40% | 高所ボーナス |
| 水辺 | 80% | -10% | 一部ユニットのみ |
| 建物内 | 90% | +30% | 屋内戦闘 |

#### 2.1.5 戦闘計算
```
ダメージ = (攻撃力 × 武器威力 × 地形補正) - (防御力 × 防具補正 × 地形効果)
命中率 = 基本命中率 + 指揮官補正 - 回避率
```

### 2.2 職業システム（忍者クラス）

#### 2.2.1 基本クラス
1. **上忍（じょうにん）** - 指揮官クラス
   - 高い指揮能力と作戦能力
   - ユニット全体バフ
   
2. **中忍（ちゅうにん）** - バランス型
   - HP: 中、攻撃力: 中、防御力: 中
   - 移動力: 標準
   
3. **下忍（げにん）** - 基本兵士
   - HP: 低、攻撃力: 低、防御力: 低
   - 移動力: 高い

#### 2.2.2 特殊クラス（八忍衆システム）
1. **影忍（かげにん）** - ステルス特化
   - 透明化能力、罠設置
   - 視界: 広い、移動力: 高い
   
2. **鉄忍（てつにん）** - 防御特化
   - HP: 高、防御力: 最高
   - 移動力: 低い
   
3. **風忍（かぜにん）** - 機動力特化
   - 移動力: 最高、回避率: 高
   - HP: 低い
   
4. **火忍（ひのにん）** - 攻撃特化
   - 攻撃力: 最高、範囲攻撃
   - 防御力: 低い

### 2.3 装備・アイテムシステム

#### 2.3.1 アイテム
##### 2.3.1.1 武器
- **刀剣類**: 近接戦闘用
- **飛び道具**: 手裏剣
##### 2.3.1.2 アイテム
- **兵糧薬**: HP回復

#### 2.3.2 耐久度
- 手裏剣は100回使用でなくなる
- アイテムは1回限り

## 3. メタゲームシステム

### 3.1 拠点システム

#### 3.1.1 本拠地（里）
- **機能**:
  - ユニット編成
  - アイテム生産

#### 3.1.2 都市占領
- 中立都市の占領で収入増加
- 占領都市での生産

### 3.2 内政システム

#### 3.2.1 経済
- **収入源**:
  - 基本収入: 1分ごと
  - 占領都市: 人口×10両/分

#### 3.2.2 生産
| アイテム | 生産時間 | 費用   |
| ---- | ---- | ---- |
| 手裏剣  | 30秒  | 100両 |
| 回復薬  | 45秒  | 150両 |
| 忍者刀  | 60秒  | 150両 |

### 3.4 防衛システム

#### 3.4.1 防衛施設
- **やぐら**: 遠距離攻撃
- **堀**: 移動速度低下
- **罠**: 各種トラップ

#### 3.4.2 防衛作戦
- 巡回ルート設定

## 4. UIシステム

### 4.1 戦闘画面UI
- **メインビュー**: 
  - ドット絵の戦場マップ
  - ユニット情報表示
  - ミニマップ
  
- **コマンドパネル(ユニットを選択したときに表示)**:
  - 移動指示ボタン
  - 戦闘指示ボタン
  - 特殊行動メニュー
  
- **情報パネル**(ユニットを選択したときに表示)**:
  - 選択ユニット詳細
  - HPバー
  - 装備・アイテム

### 4.2 拠点画面UI
- **施設メニュー**:
  - 編成所
  - 生産所
  
- **管理画面**:
  - 忍者一覧
  - 在庫管理

## 5. セリフ・ストーリーシステム

### 5.1 セリフシステム
- **実装方式**:
  - JSONベースの会話データ
  - キャラクター立ち絵表示
  - テキストウィンドウ

### 5.2 会話イベント
- **発生タイミング**:
  - ステージ開始時
  - 特定条件達成時
  - 敵将遭遇時
  - ステージクリア時

## 6. フラグ・進行管理システム

### 6.1 フラグ管理
- **フラグ種別**:
  - ストーリーフラグ
  - クリアフラグ
  - イベントフラグ
  - 隠し要素フラグ

### 6.2 条件分岐
- 複数条件のAND/OR判定
- 数値条件（レベル、所持金等）
- 時限イベント

## 7. セーブシステム

### 7.1 セーブデータ構造
```json
{
  "saveSlot": 1,
  "saveDate": "2024-01-01 12:00:00",
  "playerData": {
    "clan": "風魔",
    "stage": 5,
    "money": 10000,
    "units": [],
    "items": [],
    "flags": {}
  }
}
```

### 7.2 セーブ機能
- **セーブスロット**: 3つ
- **オートセーブ**: ステージクリア時
- **クイックセーブ**: 戦闘中可能
